<!DOCTYPE html>
<html lang="en">
<head>
	<title>Library (Search)</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
	<!-- (Optional) Latest compiled and minified JavaScript translation files -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/i18n/defaults-*.min.js"></script>
</head>
<body>

<nav class="navbar navbar-inverse">
	<div class="container-fluid">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">Library</a>
		</div>
		<ul class="nav navbar-nav">
			<li><a href="home.html">Home</a></li>
			<li class="active"><a href="#">Search</a></li>
			<li><a href="add.html">Add</a></li>
			<li><a href="remove.html">Remove</a></li>
			<li><a href="#">Contact the administrator</a></li>
		</ul>
		<ul class="nav navbar-nav navbar-right">
			<li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
			<li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
		</ul>
	</div>
</nav>

<div class="jumbotron text-center ">
	<h1>Welcome to my library!</h1>
	<p>There are lots of books here!</p>
	<p><small class="text-muted">--Ben--</small></p>
</div>

<div class="container" id="mainDiv">
	<div class="row" align="center" >
		Select Subject:
		<select class="selectpicker" data-live-search="true" id="sName">
				<option value="大雄">大雄</option>
				<option value="小夫">小夫</option>
				<option value="靜香">靜香</option>
				<option value="胖虎">胖虎</option>
				<option value="多拉A夢">多拉A夢</option>
				<option value="小杉">小杉</option>
				<option value="">全部</option>
		</select>
		&nbsp;
		<button type="button" class="btn btn-success" onclick="showText()">Show</button>
	</div>

	<div class="row">
		<table class="table table-hover" id="showTable">
			<!--thead><tr><th>人名</th><th>貼文</th></tr></thead>
			<tbody>
				<tr><td>John</td><td>Doe</td></tr>
				<tr>
					<td>Mary</td>
					<td>Moe</td>
				</tr>
				<tr>
					<td>July</td>
					<td>Dooley</td>
				</tr>
			</tbody-->
		</table>
	</div>
	<script type="text/javascript">
		function showText(){
			let name = document.getElementById("sName").value;
			let query="";
			if(name!="")
				query = "select pName, content from articles as a, users as u where a.pID = u.ID and u.pName='"+name+"'";
			else
				query = "select pName, content from articles as a, users as u where a.pID = u.ID";


			$.ajax({
				type:"POST", //傳值方式有分 post & get
				url:'getContents.php',
				data:{ // 傳值設定
					sql:query,
					db:"moodproject" 
				},
				dataType:"JSON", // 設定回傳型態
				// 如果傳值成功時
				success:function(data){
					console.log(data);
					let myTab = document.getElementById("showTable");
					myTab.innerHTML = "";
					myTab.innerHTML += '<thead><tr><th>人名</th><th>貼文</th></tr></thead><tbody>';
					for(let i in data){
						myTab.innerHTML += "<tr><td>"+data[i].pName+"</td><td>"+data[i].content+"</td></tr>";
					}
					myTab.innerHTML += '</tbody>';
				},
				// 如果傳值失敗時
				error:function(){
					console.log("ERROR");
				}
			});

			
		}
	</script>
	<!--script type="text/javascript">
		function generateArticle(titles, contents){
			let mainDiv = document.getElementById("mainDiv");
			let flat = 0;
			while(flat<titles.length){
				let rowDiv = document.createElement("div");
				rowDiv.setAttribute("class", "row");
				for(let i=0; i<3 && flat<titles.length; i++){
					var div = document.createElement("div");
					div.setAttribute("class", "col-sm-4 modal-content");
					div.innerHTML = "<p class='modal-header'>"+titles[flat]+"</p><h3>"+contents[flat]+"</h3>";
					rowDiv.appendChild(div);
					flat+=1;
				}
				mainDiv.appendChild(rowDiv);
			}
		}


		$.ajax({
			type:"POST", //傳值方式有分 post & get
			url:'getContents.php',
			data:{ // 傳值設定
				sql:"select pName, content from articles as a, users as u where a.pID = u.ID;",
				db:"moodproject" 
			},
			dataType:"JSON", // 設定回傳型態
			// 如果傳值成功時
			success:function(data){
				console.log(data);
				let titles = new Array();
				let contents = new Array();
				for(let i in data){
					titles.push(data[i].pName);
					contents.push(data[i].content);
				}
				console.log(titles);
				console.log(contents);
				generateArticle(titles, contents);

			},
			// 如果傳值失敗時
			error:function(){
				console.log("ERROR");
			}
		});
	</script-->
</div>

</body>
</html>
